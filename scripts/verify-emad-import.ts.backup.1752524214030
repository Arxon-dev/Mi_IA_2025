import { PrismaClient } from '@prisma/client';

const prisma = new PrismaClient();

async function verifyImport() {
  try {
    console.log('ğŸ” Verificando importaciÃ³n de preguntas EMAD...\n');

    // Contar total de preguntas
    const totalCount = await prisma.emad.count();
    console.log(`ğŸ“Š Total de preguntas en la tabla emad: ${totalCount}`);

    // Obtener algunas preguntas de muestra
    const sampleQuestions = await prisma.emad.findMany({
      take: 3,
      orderBy: { questionNumber: 'asc' }
    });

    console.log('\nğŸ“ Ejemplos de preguntas importadas:\n');

    sampleQuestions.forEach((question, index) => {
      console.log(`â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•`);
      console.log(`PREGUNTA ${question.questionNumber}`);
      console.log(`â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•`);
      console.log(`ğŸ“‹ TÃ­tulo: ${question.title}`);
      console.log(`â“ Pregunta: ${question.question}`);
      console.log(`ğŸ“š CategorÃ­a: ${question.category}`);
      console.log(`ğŸ¯ Dificultad: ${question.difficulty}`);
      console.log(`ğŸ“– Tipo: ${question.type}`);
      console.log(`ğŸ”¢ Opciones (${question.options.length}):`);
      
      question.options.forEach((option, optIndex) => {
        const isCorrect = optIndex === question.correctAnswerIndex;
        const marker = isCorrect ? 'âœ…' : 'âŒ';
        console.log(`   ${marker} ${optIndex + 1}. ${option}`);
      });
      
      if (question.feedback) {
        console.log(`ğŸ’¡ RetroalimentaciÃ³n:`);
        console.log(`   ${question.feedback.substring(0, 150)}${question.feedback.length > 150 ? '...' : ''}`);
      }
      
      console.log(`ğŸ“… Creado: ${question.createdAt.toLocaleDateString()}`);
      console.log('');
    });

    // Verificar distribuciÃ³n por estado
    const activeCount = await prisma.emad.count({ where: { isActive: true } });
    const inactiveCount = await prisma.emad.count({ where: { isActive: false } });

    console.log(`ğŸ“ˆ Estado de las preguntas:`);
    console.log(`   ğŸŸ¢ Activas: ${activeCount}`);
    console.log(`   ğŸ”´ Inactivas: ${inactiveCount}`);

    // Verificar que todas tengan opciones vÃ¡lidas
    const questionsWithoutOptions = await prisma.emad.count({
      where: {
        OR: [
          { options: { isEmpty: true } },
          { correctAnswerIndex: { lt: 0 } }
        ]
      }
    });

    console.log(`\nğŸ” ValidaciÃ³n de integridad:`);
    console.log(`   âŒ Preguntas con problemas: ${questionsWithoutOptions}`);
    console.log(`   âœ… Preguntas vÃ¡lidas: ${totalCount - questionsWithoutOptions}`);

    if (questionsWithoutOptions === 0) {
      console.log('\nğŸ‰ Â¡Todas las preguntas se importaron correctamente!');
    } else {
      console.log('\nâš ï¸  Algunas preguntas tienen problemas de validaciÃ³n');
    }

  } catch (error) {
    console.error('âŒ Error durante la verificaciÃ³n:', error);
  } finally {
    await prisma.$disconnect();
  }
}

if (require.main === module) {
  verifyImport().catch(console.error);
}

export { verifyImport }; 