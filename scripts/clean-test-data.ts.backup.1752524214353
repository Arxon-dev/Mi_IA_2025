import { PrismaClient } from '@prisma/client';

const prisma = new PrismaClient();

async function cleanTestData() {
  try {
    console.log('ğŸ§¹ LIMPIANDO DATOS DE PRUEBA...\n');
    
    // Mostrar datos actuales
    const currentUsers = await prisma.telegramUser.findMany({
      select: {
        id: true,
        username: true,
        firstName: true,
        totalPoints: true,
        totalResponses: true
      }
    });
    
    console.log('ğŸ“Š USUARIOS ACTUALES EN LA BASE DE DATOS:');
    currentUsers.forEach((user, index) => {
      const name = user.username || user.firstName || 'Sin nombre';
      console.log(`   ${index + 1}. ${name} - ${user.totalPoints} pts - ${user.totalResponses} respuestas`);
    });
    
    console.log(`\nğŸ“ˆ Total de usuarios: ${currentUsers.length}`);
    
    // Confirmar limpieza
    console.log('\nâš ï¸  Â¿EstÃ¡s seguro de que quieres eliminar TODOS los datos de gamificaciÃ³n?');
    console.log('   - Se eliminarÃ¡n todos los usuarios');
    console.log('   - Se eliminarÃ¡n todas las respuestas');
    console.log('   - Se eliminarÃ¡n todas las estadÃ­sticas');
    console.log('   - Se eliminarÃ¡n todos los logros');
    
    // En un entorno real, aquÃ­ pedirÃ­as confirmaciÃ³n al usuario
    // Por ahora, comentamos la limpieza real y solo mostramos quÃ© se harÃ­a
    
    console.log('\nğŸ”§ PARA LIMPIAR LOS DATOS, ejecuta este script con --confirm');
    console.log('   Ejemplo: npx tsx scripts/clean-test-data.ts --confirm');
    
    // Verificar si se pasÃ³ el flag --confirm
    const args = process.argv.slice(2);
    const shouldClean = args.includes('--confirm');
    
    if (shouldClean) {
      console.log('\nğŸ§¹ INICIANDO LIMPIEZA...');
      
      // Limpiar en orden para evitar errores de foreign key
      console.log('   ğŸ—‘ï¸  Eliminando logros de usuarios...');
      await prisma.userAchievement.deleteMany({});
      
      console.log('   ğŸ—‘ï¸  Eliminando estadÃ­sticas semanales...');
      await prisma.weeklyStats.deleteMany({});
      
      console.log('   ğŸ—‘ï¸  Eliminando respuestas...');
      await prisma.telegramResponse.deleteMany({});
      
      console.log('   ğŸ—‘ï¸  Eliminando usuarios...');
      await prisma.telegramUser.deleteMany({});
      
      console.log('   ğŸ—‘ï¸  Eliminando definiciones de logros...');
      await prisma.achievement.deleteMany({});
      
      console.log('\nâœ… Â¡LIMPIEZA COMPLETADA!');
      console.log('ğŸ“Š La base de datos estÃ¡ ahora vacÃ­a y lista para usuarios reales.');
      console.log('ğŸ® Cuando usuarios reales respondan preguntas, aparecerÃ¡n en el ranking.');
      
    } else {
      console.log('\nğŸ’¡ Si quieres proceder con la limpieza, ejecuta:');
      console.log('   npx tsx scripts/clean-test-data.ts --confirm');
    }
    
  } catch (error) {
    console.error('âŒ Error limpiando datos:', error);
  } finally {
    await prisma.$disconnect();
  }
}

cleanTestData(); 